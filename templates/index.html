<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Pr√©diction Prix Billet Avion ‚úàÔ∏è</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f7f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background: #fff;
            padding: 30px 40px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 100%;
        }
        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #333;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }
        select, input[type=text], input[type=range] {
            width: 100%;
            padding: 8px 10px;
            margin-top: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: #ddd;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
        }
        button {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        h2.low { color: green; text-align: center; margin-top: 20px; }
        h2.medium { color: orange; text-align: center; margin-top: 20px; }
        h2.high { color: red; text-align: center; margin-top: 20px; }
    </style>

<script>
    function updateDaysValue(val){
        document.getElementById("days_display").innerText = val;
    }
</script>
</head>
<body>
    <div class="container">
        <h1>Pr√©diction Prix Billet Avion ‚úàÔ∏è</h1>
        <form method="post">
            <label>Compagnie :</label>
            <select name="airline">{% for a in airlines %}<option value="{{ a }}">{{ a }}</option>{% endfor %}</select>

            <label>Ville d√©part :</label>
            <select id="source_city" name="source_city" onchange="updateDuration()">{% for s in sources %}<option value="{{ s }}">{{ s }}</option>{% endfor %}</select>

            <label>Ville arriv√©e :</label>
            <select id="destination_city" name="destination_city" onchange="updateDuration()">{% for d in destinations %}<option value="{{ d }}">{{ d }}</option>{% endfor %}</select>

            <label>Classe :</label>
            <select name="class">{% for c in classes %}<option value="{{ c }}">{{ c }}</option>{% endfor %}</select>

            <label>Escales :</label>
            <select name="stops">{% for st in stops %}<option value="{{ st }}">{{ st }}</option>{% endfor %}</select>

            <label>D√©part :</label>
            <select name="departure_time">{% for dep in departure_times %}<option value="{{ dep }}">{{ dep }}</option>{% endfor %}</select>

            <label>Arriv√©e :</label>
            <select name="arrival_time">{% for arr in arrival_times %}<option value="{{ arr }}">{{ arr }}</option>{% endfor %}</select>

            <label>Dur√©e (heures) :</label>
            <input type="text" id="duration" name="duration" value="3" readonly>

            <label>Jours avant d√©part :</label>
            <input type="range" name="days_left" min="0" max="180" value="30" oninput="updateDaysValue(this.value)">
            <div>Jours : <span id="days_display">30</span></div>

            <button type="submit">Pr√©dire le prix üí∞</button>
        </form>

        <script>
            // R√©cup√©rer le dictionnaire de dur√©es envoy√© par Flask
            const durationDict = JSON.parse('{{ duration_dict | tojson | safe }}');
            function updateDuration() {
                const dep = document.getElementById("source_city").value;
                const arr = document.getElementById("destination_city").value;
                const key = dep + "-" + arr; // correspond au format des cl√©s du dictionnaire

                const input = document.getElementById("duration");
                input.value = durationDict[key] ? durationDict[key].toFixed(1) : 3; // dur√©e moyenne ou d√©faut
            }

            window.addEventListener('DOMContentLoaded', (event) => {
                updateDuration(); // Initialiser la dur√©e au chargement
            });
        </script>

        {% if price %}
            {% if price < 100 %}
                <h2 class="low">Prix estim√© : {{ price }} TND</h2>
            {% elif price < 300 %}
                <h2 class="medium">Prix estim√© : {{ price }} TND</h2>
            {% else %}
                <h2 class="high">Prix estim√© : {{ price }} TND</h2>
            {% endif %}
        {% endif %}
    </div>
</body>
</html>
